!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.VideoExtract=e():t.VideoExtract=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=0)}([function(t,e,n){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}n(1).toString();n(6);var a=function(){function t(e){var n=e.data,i=e.api,r=e.config;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=n,this.api=i,this.config=r||{},this.config.output=this.config.output||null,this.index=this.api.blocks.getCurrentBlockIndex()+1,this.wrapper={block:document.createElement("div"),renderSettings:document.createElement("div")},this.CSS={baseClass:this.api.styles.block,loading:this.api.styles.loader,input:this.api.styles.input+" video-extract-info__caption",button:this.api.styles.button,settingsButton:this.api.styles.settingsButton,settingsButtonActive:this.api.styles.settingsButtonActive,wrapperBlock:"video-extract",addButton:"add",actions:"video-extract-actions",frames:"video-frames",screenshotBtn:"screenshot-btn"}}return r(t,null,[{key:"toolbox",get:function(){return{title:"视频拆解",icon:n(7).default}}}]),r(t,[{key:"render",value:function(){var t=this;if(this.wrapper.block=document.createElement("div"),this.wrapper.block.setAttribute("data-title","视频拆解"),this.wrapper.block.classList.add(this.CSS.wrapperBlock),this.data&&this.data.frames&&this.data.frames.length>0){var e=this._createGIFBtn(),n=this._createFrames();return this.wrapper.block.appendChild(e),this.wrapper.block.appendChild(n),this.wrapper.block}var i=document.createElement("input"),r=document.createElement("div");return r.classList.add(this.CSS.addButton),r.innerHTML='<a class="uk-icon-button" uk-icon="plus" data-tip="从本地添加"></a>',r.addEventListener("click",(function(t){t.preventDefault(),i.click()})),i.setAttribute("type","file"),i.setAttribute("accept","video/*"),i.value=this.data&&this.data.url?this.data.url:"",i.addEventListener("change",(function(e){if(e.preventDefault(),1==e.target.files.length&&!t.wrapper.block.querySelector("video")){var n=e.target.files[0];if(n.type.match(/video\//)){var i=URL.createObjectURL(n);t._createVideo(i)}}})),this.wrapper.block.appendChild(i),this.wrapper.block.appendChild(r),r.click(),this.wrapper.block}},{key:"save",value:function(t){var e=this.data.frames;return e=e.sort((function(t,e){return t.currentTime-e.currentTime})),{ratio:this.data.ratio,time:this.data.time,width:this.data.width,height:this.data.height,frames:e}}},{key:"validate",value:function(t){return!!(t.ratio&&t.time&&t.width&&t.height)}},{key:"_createGIFBtn",value:function(){var t=this,e=document.createElement("button");return e.innerHTML="生成GIF",e.classList.add(this.CSS.button),this.api.listeners.on(e,"click",(function(e){e.preventDefault(),"imgs2gif"==t.config.output&&t.data.frames.length>0&&t.api.blocks.insert(t.config.output,{images:Array.from(t.data.frames,(function(t){return t.url}))})})),e}},{key:"_createVideo",value:function(t){var e=this;this.wrapper.block.classList.add(this.CSS.loading);var n=document.createElement("div");n.classList.add("origin");var i=document.createElement("div");i.classList.add("right");var r=document.createElement("div");r.classList.add(this.CSS.actions);var a=document.createElement("button");a.innerHTML="截屏",a.classList.add(this.CSS.button),a.classList.add(this.CSS.screenshotBtn);var o=this._createGIFBtn(),s=document.createElement("div");s.classList.add(this.CSS.frames);var d=document.createElement("div");d.classList.add("video");var c=document.createElement("div"),u=document.createElement("video");u.src=t,u.setAttribute("preload","metadata"),u.controls=!0,u.addEventListener("loadedmetadata",(function(t){if(!u.getAttribute("width")){e.wrapper.block.classList.toggle(e.CSS.loading),u.setAttribute("width",t.target.videoWidth),u.setAttribute("height",t.target.videoHeight);var n=e._getAspectRatio(t.target.videoWidth,t.target.videoHeight),i=e._getTime(t.target.duration);e.data={ratio:n,time:i,width:t.target.videoWidth,height:t.target.videoHeight,video:u,index:0,frames:[]},c.classList.add("video-extract-info"),c.innerHTML="\n              <h5 contentEditable='true' class=\"".concat(e.CSS.input,'" data-placeholder="输入视频描述"></h5>\n              <ul class="uk-comment-meta uk-subnav uk-subnav-divider ">\n                  <li>画面长 ').concat(t.target.videoWidth," px</li>\n                  <li>画面高 ").concat(t.target.videoHeight,' px</li>\n              </ul>\n              <ul class="uk-comment-meta uk-subnav uk-subnav-divider ">\n                  <li>宽高比 ').concat(n.num,"</li>\n                  <li>").concat(n.desc,'</li>\n              </ul>\n              <ul class="uk-comment-meta uk-subnav uk-subnav-divider ">\n                  <li>时长 ').concat(i.num," 秒</li>\n                  <li>").concat(i.desc,'</li>\n              </ul>\n              <ul class="uk-comment-meta uk-subnav uk-subnav-divider ">\n                  <li class="current-time">当前位于 0 秒</li>\n                  <li> - </li>\n              </ul>\n          ')}})),u.addEventListener("timeupdate",(function(){c.querySelector(".current-time").innerText="当前位于 "+u.currentTime.toFixed(1)+" 秒"})),this.api.listeners.on(a,"click",(function(t){if(t.preventDefault(),"1"!=a.getAttribute("clicked")){a.setAttribute("clicked","1");var n=e._screenshotForVideo(u),i=u.currentTime,r=e.data.frames.length+"_"+(new Date).getTime();e.data&&!e.data.frames&&(e.data.frames=[]);var o={index:e.data.frames.length+1,url:n,currentTime:i,id:r,width:u.videoWidth,height:u.videoHeight};e.data.frames.push(o);var d=e._createFrame(o);s.appendChild(d),setTimeout((function(){a.setAttribute("clicked","0")}),200)}})),i.appendChild(c),r.appendChild(a),r.appendChild(o),r.appendChild(s),d.appendChild(u),n.appendChild(d),n.appendChild(i),this.wrapper.block.innerHTML="",this.wrapper.block.appendChild(n),this.wrapper.block.appendChild(r)}},{key:"_createFrame",value:function(t){var e=this,n=document.createElement("div");n.classList.add("frame"),n.setAttribute("frame-id",t.id),n.setAttribute("data-index",t.index);var i=URL.createObjectURL(this._dataURLtoBlob(t.url));return n.innerHTML='\n      <img data-src="'.concat(i,'" data-width="').concat(t.width,'" data-height="').concat(t.height,'" alt="').concat(t.currentTime,'" uk-img>\n      '),n.addEventListener("click",(function(t){t.preventDefault(),e.data.frames=e.data.frames.filter((function(t){return t.id!=id})),n.remove()})),n}},{key:"_createFrames",value:function(){var t=this,e=document.createElement("div");if(e.classList.add(this.CSS.frames),this.data&&this.data.frames&&this.data.frames.length>0){this.data.frames=this.data.frames.sort((function(t,e){return t.index-e.index})),Array.from(this.data.frames,(function(n){var i=t._createFrame(n);e.appendChild(i)}))}return e}},{key:"_screenshotForVideo",value:function(t){var e=document.createElement("canvas"),n=e.getContext("2d");return e.width=t.videoWidth,e.height=t.videoHeight,n.drawImage(t,0,0,t.videoWidth,t.videoHeight),e.toDataURL()}},{key:"_dataURLtoBlob",value:function(t){for(var e=t.split(","),n=e[0].match(/:(.*?);/)[1],i=atob(e[1]),r=i.length,a=new Uint8Array(r);r--;)a[r]=i.charCodeAt(r);return new Blob([a],{type:n})}},{key:"_getAspectRatio",value:function(t,e){var n=parseFloat((t/e).toFixed(2)),i="-";return Math.abs(n-.56)<.05&&(console.log("--竖屏---"),i="竖屏"),Math.abs(n-4/3)<.05&&(console.log("--传统---"),n="4:3",i="传统"),Math.abs(n-16/9)<.05&&(console.log("--宽屏---"),n="16:9",i="宽屏"),Math.abs(n-2.35)<.05&&(console.log("--电影---"),n="2.35",i="电影"),{num:n,desc:i}}},{key:"_getTime",value:function(t){var e=parseFloat(t.toFixed(1)),n="-";return e<=16?n="短视频":e>60&&(n="长视频"),{num:e,desc:n}}}]),t}();t.exports=a},function(t,e,n){var i=n(2);"string"==typeof i&&(i=[[t.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(4)(i,r);i.locals&&(t.exports=i.locals)},function(t,e,n){(t.exports=n(3)(!1)).push([t.i,".video-extract {\n    padding: 20px 0;\n    /* display: flex;\n    justify-content: space-between;\n    flex-direction: column; */\n}\n\n.video-extract::before {\n    content: attr(data-title);\n    font-size: 12px;\n    font-weight: 800;\n    color: #6e8a98;\n    background-color: #fff59f;\n    padding: 4px;\n    letter-spacing: 1px;\n}\n\n.video-extract .origin {\n    display: flex;\n    justify-content: space-around;\n}\n\n.video-extract .video {\n    padding: 20px 0;\n    display: flex;\n    justify-content: space-between;\n    flex-direction: column;\n}\n\n.video-extract .video video {\n    outline: none;\n    border: none;\n    max-width: 320px!important;\n    width: 90%!important;\n    /* height: 100%; */\n}\n\n.video-extract .video .controls {\n    display: flex;\n    flex-direction: column;\n    max-width: 300px;\n    width: 50%;\n    /* height: 100%; */\n}\n\n.video-extract input {\n    display: none;\n}\n\n.video-extract button {\n    outline: none;\n    min-width: 98px;\n    margin: 32px;\n}\n\n.video-extract .add {\n    display: flex;\n    width: 200px;\n    background: #eeeeee;\n    /* height: 88px; */\n    margin: 8px;\n    border-radius: 4px;\n    padding: 28px;\n    /* justify-content: center; */\n    /* align-items: center; */\n    cursor: pointer;\n}\n\n.video-extract .add:hover {\n    background-color: rgb(227, 227, 227);\n    color: white;\n}\n\n.video-extract .uk-icon-button {\n    background-color: #9E9E9E;\n    color: white;\n}\n\n.video-extract .uk-icon-button::after {\n    content: attr(data-tip);\n    position: absolute;\n    margin-left: 56px;\n    font-size: 14px;\n    font-weight: 300;\n    color: #4a4a4a;\n}\n\n.video-extract .uk-progress {\n    height: 4px;\n}\n\n.video-extract .frame {\n    width: 20%;\n    max-width: 160px;\n    min-width: 100px;\n    height: 100%;\n    margin: 2px;\n}\n\n.video-extract .frame::after {\n    content: attr(data-index);\n    font-size: 12px;\n    background-color: #3F51B5;\n    color: white;\n    border-radius: 50%;\n    width: 14px;\n    text-align: center;\n    display: block;\n    position: relative;\n    height: 14px;\n    line-height: 14px;\n    top: -18px;\n    left: 4px;\n}\n\n.video-extract .frame img {\n    background-color: #eeeeee;\n}\n\n.video-extract-actions {\n    display: flex;\n    justify-content: space-around;\n    align-items: flex-start;\n}\n\n.video-extract-info {\n    flex: 1;\n    min-width: 1px;\n    padding: 20px 0;\n}\n\n.video-extract-info__caption {\n    outline: none;\n    border-radius: 0;\n    font-size: 12px;\n    display: inline;\n    width: auto;\n    margin-bottom: 24px;\n    border: none!important;\n    border-bottom: 1px #d8d8d8 solid!important;\n    text-align: center;\n}\n\n.video-extract-info__caption[contentEditable=true][data-placeholder]:empty::before {\n    position: absolute;\n    content: attr(data-placeholder);\n    color: #707684;\n    font-weight: normal;\n    opacity: 1;\n    border: none;\n    outline: none;\n}\n\n.video-extract-info__caption[contentEditable=true][data-placeholder]:empty:focus::before {\n    opacity: 0;\n    border: none;\n    outline: none;\n}\n\n.video-extract .video-frames {\n    display: flex;\n    flex-wrap: wrap;\n    width: 100%;\n}\n\n.video-extract .screenshot-btn::after {\n    content: attr(data-count);\n    font-size: 12px;\n}",""])},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var r=(o=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),a=i.sources.map((function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"}));return[n].concat(a).concat([r]).join("\n")}var o;return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n})).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},r=0;r<this.length;r++){var a=this[r][0];"number"==typeof a&&(i[a]=!0)}for(r=0;r<t.length;r++){var o=t[r];"number"==typeof o[0]&&i[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),e.push(o))}},e}},function(t,e,n){var i,r,a={},o=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=i.apply(this,arguments)),r}),s=function(t){return document.querySelector(t)},d=function(t){var e={};return function(t){if("function"==typeof t)return t();if(void 0===e[t]){var n=s.call(this,t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),c=null,u=0,l=[],h=n(5);function f(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=a[i.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](i.parts[o]);for(;o<i.parts.length;o++)r.parts.push(x(i.parts[o],e))}else{var s=[];for(o=0;o<i.parts.length;o++)s.push(x(i.parts[o],e));a[i.id]={id:i.id,refs:1,parts:s}}}}function p(t,e){for(var n=[],i={},r=0;r<t.length;r++){var a=t[r],o=e.base?a[0]+e.base:a[0],s={css:a[1],media:a[2],sourceMap:a[3]};i[o]?i[o].parts.push(s):n.push(i[o]={id:o,parts:[s]})}return n}function v(t,e){var n=d(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=l[l.length-1];if("top"===t.insertAt)i?i.nextSibling?n.insertBefore(e,i.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),l.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=d(t.insertInto+" "+t.insertAt.before);n.insertBefore(e,r)}}function m(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=l.indexOf(t);e>=0&&l.splice(e,1)}function g(t){var e=document.createElement("style");return void 0===t.attrs.type&&(t.attrs.type="text/css"),b(e,t.attrs),v(t,e),e}function b(t,e){Object.keys(e).forEach((function(n){t.setAttribute(n,e[n])}))}function x(t,e){var n,i,r,a;if(e.transform&&t.css){if(!(a=e.transform(t.css)))return function(){};t.css=a}if(e.singleton){var o=u++;n=c||(c=g(e)),i=k.bind(null,n,o,!1),r=k.bind(null,n,o,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",b(e,t.attrs),v(t,e),e}(e),i=S.bind(null,n,e),r=function(){m(n),n.href&&URL.revokeObjectURL(n.href)}):(n=g(e),i=C.bind(null,n),r=function(){m(n)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=o()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=p(t,e);return f(n,e),function(t){for(var i=[],r=0;r<n.length;r++){var o=n[r];(s=a[o.id]).refs--,i.push(s)}t&&f(p(t,e),e);for(r=0;r<i.length;r++){var s;if(0===(s=i[r]).refs){for(var d=0;d<s.parts.length;d++)s.parts[d]();delete a[s.id]}}}};var w,y=(w=[],function(t,e){return w[t]=e,w.filter(Boolean).join("\n")});function k(t,e,n,i){var r=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=y(e,r);else{var a=document.createTextNode(r),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(a,o[e]):t.appendChild(a)}}function C(t,e){var n=e.css,i=e.media;if(i&&t.setAttribute("media",i),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function S(t,e,n){var i=n.css,r=n.sourceMap,a=void 0===e.convertToAbsoluteUrls&&r;(e.convertToAbsoluteUrls||a)&&(i=h(i)),r&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var o=new Blob([i],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,i=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var r,a=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?t:(r=0===a.indexOf("//")?a:0===a.indexOf("/")?n+a:i+a.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")}))}},function(t,e,n){var i;!function(){"use strict";var r={};function a(t,e,n){for(var i=n.data,r=n.width,a=~~t.x,o=~~(t.x+t.width),s=~~t.y,d=~~(t.y+t.height),c=255*t.weight,u=s;u<d;u++)for(var l=a;l<o;l++){i[4*(u*r+l)+3]+=c}}function o(t,e,n){for(var i={detail:0,saturation:0,skin:0,boost:0,total:0},r=e.data,a=t.scoreDownSample,o=1/a,d=e.height*a,c=e.width*a,u=e.width,l=0;l<d;l+=a)for(var h=0;h<c;h+=a){var f=4*(~~(l*o)*u+~~(h*o)),p=s(t,n,h,l),v=r[f+1]/255;i.skin+=r[f]/255*(v+t.skinBias)*p,i.detail+=v*p,i.saturation+=r[f+2]/255*(v+t.saturationBias)*p,i.boost+=r[f+3]/255*p}return i.total=(i.detail*t.detailWeight+i.skin*t.skinWeight+i.saturation*t.saturationWeight+i.boost*t.boostWeight)/(n.width*n.height),i}function s(t,e,n,i){if(e.x>n||n>=e.x+e.width||e.y>i||i>=e.y+e.height)return t.outsideImportance;n=(n-e.x)/e.width,i=(i-e.y)/e.height;var r=2*v(.5-n),a=2*v(.5-i),o=Math.max(r-1+t.edgeRadius,0),s=Math.max(a-1+t.edgeRadius,0),d=(o*o+s*s)*t.edgeWeight,c=1.41-m(r*r+a*a);return t.ruleOfThirds&&(c+=1.2*Math.max(0,c+d+.5)*(b(r)+b(a))),c+d}function d(t,e,n,i){var r=m(e*e+n*n+i*i),a=e/r-t.skinColor[0],o=n/r-t.skinColor[1],s=i/r-t.skinColor[2];return 1-m(a*a+o*o+s*s)}function c(t,e,n){this.width=t,this.height=e,this.data=n?new Uint8ClampedArray(n):new Uint8ClampedArray(t*e*4)}function u(t,e){for(var n=t.data,i=t.width,r=Math.floor(t.width/e),a=Math.floor(t.height/e),o=new c(r,a),s=o.data,d=1/(e*e),u=0;u<a;u++)for(var l=0;l<r;l++){for(var h=4*(u*r+l),f=0,p=0,v=0,m=0,g=0,b=0,x=0;x<e;x++)for(var w=0;w<e;w++){var y=4*((u*e+x)*i+(l*e+w));f+=n[y],p+=n[y+1],v+=n[y+2],m+=n[y+3],g=Math.max(g,n[y]),b=Math.max(b,n[y+1])}s[h]=f*d*.5+.5*g,s[h+1]=p*d*.7+.3*b,s[h+2]=v*d,s[h+3]=m*d}return o}function l(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n}function h(t){return{open:function(e){var n=e.naturalWidth||e.width,i=e.naturalHeight||e.height,a=t(n,i),o=a.getContext("2d");return!e.naturalWidth||e.naturalWidth==e.width&&e.naturalHeight==e.height?(a.width=e.width,a.height=e.height):(a.width=e.naturalWidth,a.height=e.naturalHeight),o.drawImage(e,0,0),r.Promise.resolve(a)},resample:function(e,n,i){return Promise.resolve(e).then((function(e){var a=t(~~n,~~i);return a.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,a.width,a.height),r.Promise.resolve(a)}))},getData:function(t){return Promise.resolve(t).then((function(t){var e=t.getContext("2d").getImageData(0,0,t.width,t.height);return new c(t.width,t.height,e.data)}))}}}r.Promise="undefined"!=typeof Promise?Promise:function(){throw new Error("No native promises and smartcrop.Promise not set.")},r.DEFAULTS={width:0,height:0,aspect:0,cropWidth:0,cropHeight:0,detailWeight:.2,skinColor:[.78,.57,.44],skinBias:.01,skinBrightnessMin:.2,skinBrightnessMax:1,skinThreshold:.8,skinWeight:1.8,saturationBrightnessMin:.05,saturationBrightnessMax:.9,saturationThreshold:.4,saturationBias:.2,saturationWeight:.1,scoreDownSample:8,step:8,scaleStep:.1,minScale:1,maxScale:1,edgeRadius:.4,edgeWeight:-20,outsideImportance:-.5,boostWeight:100,ruleOfThirds:!0,prescale:!0,imageOperations:null,canvasFactory:l,debug:!1},r.crop=function(t,e,n){var i=g({},r.DEFAULTS,e);i.aspect&&(i.width=i.aspect,i.height=1),null===i.imageOperations&&(i.imageOperations=h(i.canvasFactory));var s=i.imageOperations,l=1,v=1;return s.open(t,i.input).then((function(t){return i.width&&i.height&&(l=f(t.width/i.width,t.height/i.height),i.cropWidth=~~(i.width*l),i.cropHeight=~~(i.height*l),i.minScale=f(i.maxScale,p(1/l,i.minScale)),!1!==i.prescale&&((v=f(p(256/t.width,256/t.height),1))<1?(t=s.resample(t,t.width*v,t.height*v),i.cropWidth=~~(i.cropWidth*v),i.cropHeight=~~(i.cropHeight*v),i.boost&&(i.boost=i.boost.map((function(t){return{x:~~(t.x*v),y:~~(t.y*v),width:~~(t.width*v),height:~~(t.height*v),weight:t.weight}})))):v=1)),t})).then((function(t){return s.getData(t).then((function(t){for(var e=function(t,e){var n={},i=new c(e.width,e.height);(function(t,e){for(var n=t.data,i=e.data,r=t.width,a=t.height,o=0;o<a;o++)for(var s=0;s<r;s++){var d,c=4*(o*r+s);d=0===s||s>=r-1||0===o||o>=a-1?w(n,c):4*w(n,c)-w(n,c-4*r)-w(n,c-4)-w(n,c+4)-w(n,c+4*r),i[c+1]=d}})(e,i),function(t,e,n){for(var i=e.data,r=n.data,a=e.width,o=e.height,s=0;s<o;s++)for(var c=0;c<a;c++){var u=4*(s*a+c),l=x(i[u],i[u+1],i[u+2])/255,h=d(t,i[u],i[u+1],i[u+2]),f=h>t.skinThreshold,p=l>=t.skinBrightnessMin&&l<=t.skinBrightnessMax;r[u]=f&&p?(h-t.skinThreshold)*(255/(1-t.skinThreshold)):0}}(t,e,i),function(t,e,n){for(var i=e.data,r=n.data,a=e.width,o=e.height,s=0;s<o;s++)for(var d=0;d<a;d++){var c=4*(s*a+d),u=x(i[c],i[c+1],i[c+2])/255,l=y(i[c],i[c+1],i[c+2]),h=l>t.saturationThreshold,f=u>=t.saturationBrightnessMin&&u<=t.saturationBrightnessMax;r[c+2]=f&&h?(l-t.saturationThreshold)*(255/(1-t.saturationThreshold)):0}}(t,e,i),function(t,e){if(!t.boost)return;for(var n=e.data,i=0;i<e.width;i+=4)n[i+3]=0;for(i=0;i<t.boost.length;i++)a(t.boost[i],t,e)}(t,i);for(var r=u(i,t.scoreDownSample),s=-1/0,l=null,h=function(t,e,n){for(var i=[],r=f(e,n),a=t.cropWidth||r,o=t.cropHeight||r,s=t.maxScale;s>=t.minScale;s-=t.scaleStep)for(var d=0;d+o*s<=n;d+=t.step)for(var c=0;c+a*s<=e;c+=t.step)i.push({x:c,y:d,width:a*s,height:o*s});return i}(t,e.width,e.height),p=0,v=h.length;p<v;p++){var m=h[p];m.score=o(t,r,m),m.score.total>s&&(l=m,s=m.score.total)}n.topCrop=l,t.debug&&l&&(n.crops=h,n.debugOutput=i,n.debugOptions=t,n.debugTopCrop=g({},n.topCrop));return n}(i,t),r=e.crops||[e.topCrop],s=0,l=r.length;s<l;s++){var h=r[s];h.x=~~(h.x/v),h.y=~~(h.y/v),h.width=~~(h.width/v),h.height=~~(h.height/v)}return n&&n(e),e}))}))},r.isAvailable=function(t){if(!r.Promise)return!1;if((t?t.canvasFactory:l)===l&&!document.createElement("canvas").getContext("2d"))return!1;return!0},r.importance=s,r.ImgData=c,r._downSample=u,r._canvasImageOperations=h;var f=Math.min,p=Math.max,v=Math.abs,m=Math.sqrt;function g(t){for(var e=1,n=arguments.length;e<n;e++){var i=arguments[e];if(i)for(var r in i)t[r]=i[r]}return t}function b(t){return t=16*((t-1/3+1)%2*.5-.5),Math.max(1-t*t,0)}function x(t,e,n){return.5126*n+.7152*e+.0722*t}function w(t,e){return x(t[e],t[e+1],t[e+2])}function y(t,e,n){var i=p(t/255,e/255,n/255),r=f(t/255,e/255,n/255);if(i===r)return 0;var a=i-r;return(i+r)/2>.5?a/(2-i-r):a/(i+r)}void 0===(i=function(){return r}.call(e,n,e,t))||(t.exports=i),e.smartcrop=r,t.exports=r}()},function(t,e,n){"use strict";n.r(e),e.default='<svg width="17" height="13" viewBox="0 0 17 13" xmlns="http://www.w3.org/2000/svg">\n<path d="M14,0.1 C15,0.2 16.3,0.1 17,0.9 C17.8,1.7 17.9,3 17.9,4 C18,5.2 18,6.9 18,8 C17.9,9.1 18,10.4 17.5,11.4 C17,12.5 16.1,12.9 15,13 C13.8,13.1 6.4,13.1 4,13 C2.9,12.9 1.6,12.9 0.8,12 C0.1,11.2 0.1,10 -2.22044605e-16,9 C0,7.8 0,6.1 0,4.9 C0,3.8 0,2.5 0.5,1.5 C1,0.5 2,0.3 3.1,0.2 C4.3,0.1 11.6,-2.22044605e-16 14,0.1 Z M4,3.5 L4,9.5 L9.5,6.5 L4,3.5 Z M12,7.4 C12.5522847,7.4 13,6.95228475 13,6.4 C13,5.84771525 12.5522847,5.4 12,5.4 C11.4477153,5.4 11,5.84771525 11,6.4 C11,6.95228475 11.4477153,7.4 12,7.4 Z" id="Shape"></path>\n</svg>'}])}));